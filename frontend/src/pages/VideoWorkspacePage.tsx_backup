import { useCallback, useEffect, useRef, useState } from "react";

/* â”€â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

interface JobStatus {
  job_id: string;
  video_id: string;
  status: "pending" | "processing" | "ready" | "failed";
  progress: number;
  message: string;
}

interface SearchHit {
  text: string;
  start_seconds: number;
  end_seconds: number;
  distance: number | null;
  snippet_index: number | null;
  chunk_index: number | null;
  source: "transcript" | "visual";
}

interface SearchResponse {
  query: string;
  video_id: string;
  hits: SearchHit[];
  best_window: { start_seconds: number; end_seconds: number; hit_count: number } | null;
  clip_url: string | null;
  visual_hits_count: number;
  transcript_hits_count: number;
}

/* â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

const API = "/api/v1";

function fmtTime(s: number): string {
  const m = Math.floor(s / 60);
  const sec = Math.floor(s % 60);
  return `${String(m).padStart(2, "0")}:${String(sec).padStart(2, "0")}`;
}

function distBadge(d: number | null) {
  if (d === null) return null;
  const pct = Math.round(Math.max(0, 1 - d) * 100);
  const color =
    pct >= 80 ? "bg-green-600" : pct >= 50 ? "bg-yellow-600" : "bg-red-600";
  return (
    <span className={`ml-2 text-[10px] px-1.5 py-0.5 rounded-full ${color} text-white`}>
      {pct}%
    </span>
  );
}

function sourceBadge(source: "transcript" | "visual") {
  if (source === "visual") {
    return (
      <span className="text-[10px] px-1.5 py-0.5 rounded-full bg-violet-600/80 text-white flex items-center gap-1">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
          <circle cx="12" cy="12" r="3" />
        </svg>
        CLIP
      </span>
    );
  }
  return (
    <span className="text-[10px] px-1.5 py-0.5 rounded-full bg-sky-600/60 text-white flex items-center gap-1">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
        <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
        <line x1="12" y1="19" x2="12" y2="23" />
      </svg>
      Transcript
    </span>
  );
}

type FilterMode = "all" | "transcript" | "visual";

/* â”€â”€â”€ Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

export default function VideoWorkspacePage() {
  /* refs */
  const inputRef = useRef<HTMLInputElement | null>(null);
  const videoRef = useRef<HTMLVideoElement | null>(null);

  /* file / local preview */
  const [file, setFile] = useState<File | null>(null);
  const [localUrl, setLocalUrl] = useState<string | null>(null);

  /* backend state */
  const [job, setJob] = useState<JobStatus | null>(null);
  const [polling, setPolling] = useState(false);

  /* search state */
  const [query, setQuery] = useState("");
  const [searching, setSearching] = useState(false);
  const [results, setResults] = useState<SearchResponse | null>(null);
  const [searchError, setSearchError] = useState<string | null>(null);

  /* filter mode */
  const [filterMode, setFilterMode] = useState<FilterMode>("all");

  /* active hit highlight */
  const [activeIdx, setActiveIdx] = useState<number | null>(null);

  /* clip end time - when set, video will pause at this time */
  const [clipEndTime, setClipEndTime] = useState<number | null>(null);

  /* â”€â”€ Upload handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const handleFileChange = useCallback(async (f: File | null) => {
    if (!f) return;
    setFile(f);
    setLocalUrl(URL.createObjectURL(f));
    setJob(null);
    setResults(null);
    setSearchError(null);
    setFilterMode("all");

    // Upload to backend
    const form = new FormData();
    form.append("file", f);
    try {
      const res = await fetch(`${API}/videos/upload`, { method: "POST", body: form });
      if (!res.ok) throw new Error(await res.text());
      const data: JobStatus = await res.json();
      setJob(data);
      setPolling(true);
    } catch (err: any) {
      setJob({ job_id: "", video_id: "", status: "failed", progress: 0, message: err.message });
    }
  }, []);

  /* â”€â”€ Poll job status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  useEffect(() => {
    if (!polling || !job?.job_id) return;

    const id = setInterval(async () => {
      try {
        const res = await fetch(`${API}/jobs/${job.job_id}`);
        if (!res.ok) return;
        const data: JobStatus = await res.json();
        setJob(data);
        if (data.status === "ready" || data.status === "failed") {
          setPolling(false);
        }
      } catch {
        /* network blip â€” keep polling */
      }
    }, 2000);

    return () => clearInterval(id);
  }, [polling, job?.job_id]);

  /* â”€â”€ Stop video at clip end time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  useEffect(() => {
    const video = videoRef.current;
    if (!video || clipEndTime === null) return;

    const handleTimeUpdate = () => {
      if (video.currentTime >= clipEndTime) {
        video.pause();
        setClipEndTime(null); // Clear so it doesn't keep pausing
      }
    };

    video.addEventListener("timeupdate", handleTimeUpdate);
    return () => video.removeEventListener("timeupdate", handleTimeUpdate);
  }, [clipEndTime]);

  /* â”€â”€ Search handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const handleSearch = useCallback(async () => {
    if (!job?.video_id || !query.trim()) return;
    setSearching(true);
    setSearchError(null);
    setResults(null);
    setActiveIdx(null);

    const trimmed = query.trim();

    // Check for direct clip syntax: "clip: t1/t2" or "clip:t1/t2"
    const clipMatch = trimmed.match(/^clip:\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)$/i);

    try {
      if (clipMatch) {
        // Direct timestamp clip request
        const t1 = parseFloat(clipMatch[1]);
        const t2 = parseFloat(clipMatch[2]);

        if (t2 <= t1) {
          throw new Error(`End time (${t2}) must be greater than start time (${t1})`);
        }

        const res = await fetch(`${API}/videos/${job.video_id}/clip?t1=${t1}&t2=${t2}`);
        if (!res.ok) throw new Error(await res.text());
        const data = await res.json();

        // Build a synthetic SearchResponse to display the clip
        setResults({
          query: trimmed,
          video_id: job.video_id,
          hits: [],
          best_window: {
            start_seconds: t1,
            end_seconds: t2,
            hit_count: 1,
          },
          clip_url: data.clip_url,
          visual_hits_count: 0,
          transcript_hits_count: 0,
        });

        // Seek video to the clip start and set end time
        if (videoRef.current) {
          videoRef.current.currentTime = t1;
          setClipEndTime(t2);
          videoRef.current.play().catch(() => {});
        }
      } else {
        // Normal semantic search
        const params = new URLSearchParams({
          q: trimmed,
          top_k: "10",
          include_visual: "true",
        });
        const res = await fetch(`${API}/videos/${job.video_id}/search?${params}`);
        if (!res.ok) throw new Error(await res.text());
        const data: SearchResponse = await res.json();
        setResults(data);
      }
    } catch (err: any) {
      setSearchError(err.message);
    } finally {
      setSearching(false);
    }
  }, [job?.video_id, query]);

  /* â”€â”€ Seek video to a hit's timestamp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const seekTo = useCallback(
    (idx: number, startSec: number, endSec?: number) => {
      setActiveIdx(idx);
      if (videoRef.current) {
        videoRef.current.currentTime = startSec;
        if (endSec !== undefined) {
          setClipEndTime(endSec);
        } else {
          setClipEndTime(null);
        }
        videoRef.current.play().catch(() => {});
      }
    },
    [],
  );

  /* â”€â”€ Derived state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const isReady = job?.status === "ready";
  const isProcessing = job?.status === "processing" || job?.status === "pending";
  const isFailed = job?.status === "failed";

  /* Filtered hits */
  const filteredHits = results?.hits.filter((h) => {
    if (filterMode === "all") return true;
    return h.source === filterMode;
  }) ?? [];

  const hasVisual = (results?.visual_hits_count ?? 0) > 0;
  const hasTranscript = (results?.transcript_hits_count ?? 0) > 0;

  /* â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  return (
    <div className="h-screen w-screen bg-[#0a0a0f] text-white font-sans">
      {/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <header className="h-14 border-b border-white/10 flex items-center justify-between px-5 bg-[#12121a]">
        <div className="font-semibold tracking-wide text-sm flex items-center gap-2">
          <span className="text-indigo-400">â—</span> CortexON â€¢ Video Understanding
          <span className="text-[10px] text-white/30 ml-2 border border-white/10 px-1.5 py-0.5 rounded">
            + CLIP Visual Search
          </span>
        </div>

        <button
          className="rounded-md border border-white/15 px-4 py-1.5 text-xs font-medium
                     hover:bg-white/10 transition-colors"
          onClick={() => inputRef.current?.click()}
        >
          Upload video
        </button>
        <input
          ref={inputRef}
          type="file"
          accept="video/*"
          className="hidden"
          onChange={(e) => handleFileChange(e.target.files?.[0] ?? null)}
        />
      </header>

      {/* â”€â”€ Main grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <main className="h-[calc(100vh-56px)] grid grid-cols-12 gap-3 p-3 overflow-hidden">

        {/* â”€â”€ LEFT: Video player â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
        <section className="col-span-5 flex flex-col rounded-xl border border-white/10 bg-white/[0.03] overflow-hidden">
          <div className="px-4 py-3 text-xs font-semibold uppercase tracking-widest text-white/50 border-b border-white/5">
            Video
          </div>

          <div className="flex-1 flex items-center justify-center p-4">
            {!localUrl ? (
              <div className="text-center text-white/40 text-sm leading-relaxed">
                Click <span className="text-white font-medium">Upload video</span> to begin
              </div>
            ) : (
              <video
                ref={videoRef}
                className="w-full max-h-[55vh] rounded-lg bg-black"
                controls
                src={localUrl}
              />
            )}
          </div>

          {/* â”€â”€ Processing status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {job && (
            <div className="border-t border-white/5 px-4 py-3 text-xs">
              <div className="flex items-center justify-between mb-1.5">
                <span className="text-white/60">{job.message}</span>
                <span className={`font-mono ${isReady ? "text-green-400" : isFailed ? "text-red-400" : "text-yellow-400"}`}>
                  {job.status}
                </span>
              </div>
              {isProcessing && (
                <div className="w-full h-1 rounded-full bg-white/10 overflow-hidden">
                  <div
                    className="h-full rounded-full bg-indigo-500 transition-all duration-500"
                    style={{ width: `${Math.round(job.progress * 100)}%` }}
                  />
                </div>
              )}
            </div>
          )}
        </section>

        {/* â”€â”€ MIDDLE: Query panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
        <section className="col-span-3 flex flex-col rounded-xl border border-white/10 bg-white/[0.03] overflow-hidden">
          <div className="px-4 py-3 text-xs font-semibold uppercase tracking-widest text-white/50 border-b border-white/5">
            Query
          </div>

          <div className="flex-1 p-4 flex flex-col gap-3">
            <textarea
              className="w-full h-32 rounded-lg bg-black/50 border border-white/10 p-3
                         text-sm outline-none resize-none placeholder:text-white/30
                         focus:border-indigo-500/50 transition-colors"
              placeholder={
                isReady
                  ? 'Search transcripts + visual contentâ€¦\nor use "clip: 5/10" for direct timestamp (seconds)'
                  : "Upload and wait for processing to finishâ€¦"
              }
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === "Enter" && !e.shiftKey) {
                  e.preventDefault();
                  handleSearch();
                }
              }}
              disabled={!isReady}
            />

            <button
              className={`w-full rounded-lg py-2.5 text-sm font-semibold transition-all
                ${isReady && query.trim()
                  ? "bg-indigo-600 hover:bg-indigo-500 text-white cursor-pointer"
                  : "bg-white/10 text-white/30 cursor-not-allowed"}`}
              onClick={handleSearch}
              disabled={!isReady || !query.trim() || searching}
            >
              {searching ? "Searchingâ€¦" : "Search (Transcript + Visual)"}
            </button>

            {!isReady && !isFailed && file && (
              <p className="text-[11px] text-white/30 text-center leading-relaxed">
                Processing: Whisper transcription â†’ CLIP keyframe extraction â†’ Weaviate indexing.
                Search will be available once all steps complete.
              </p>
            )}

            {isFailed && (
              <p className="text-[11px] text-red-400/80 text-center">
                Processing failed â€” try re-uploading.
              </p>
            )}

            {searchError && (
              <p className="text-[11px] text-red-400/80 text-center">{searchError}</p>
            )}

            {/* Quick-help examples */}
            {isReady && !results && (
              <div className="mt-auto pt-2 border-t border-white/5 space-y-1.5">
                <p className="text-[10px] text-white/25 uppercase tracking-wider">Try</p>
                {[
                  { q: "clip: 5/10", icon: "âœ‚ï¸", label: "direct" },
                  { q: "show me when the headset appears", icon: "ğŸ™ï¸", label: "transcript" },
                  { q: "person holds a white VR headset", icon: "ğŸ‘ï¸", label: "visual" },
                  { q: "box with product branding visible", icon: "ğŸ‘ï¸", label: "visual" },
                ].map((ex) => (
                  <button
                    key={ex.q}
                    className="flex items-center gap-2 w-full text-left text-xs text-indigo-400/70 hover:text-indigo-300 transition-colors"
                    onClick={() => { setQuery(ex.q); }}
                  >
                    <span className="text-[10px]">{ex.icon}</span>
                    "{ex.q}"
                  </button>
                ))}
              </div>
            )}
          </div>
        </section>

        {/* â”€â”€ RIGHT: Results panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
        <section className="col-span-4 flex flex-col rounded-xl border border-white/10 bg-white/[0.03] overflow-hidden">
          <div className="px-4 py-3 text-xs font-semibold uppercase tracking-widest text-white/50 border-b border-white/5">
            <div className="flex items-center justify-between">
              <span>Results</span>
              {results && (
                <div className="flex items-center gap-2 normal-case tracking-normal">
                  {hasTranscript && (
                    <span className="text-sky-400">
                      {results.transcript_hits_count} transcript
                    </span>
                  )}
                  {hasTranscript && hasVisual && (
                    <span className="text-white/20">+</span>
                  )}
                  {hasVisual && (
                    <span className="text-violet-400">
                      {results.visual_hits_count} visual
                    </span>
                  )}
                </div>
              )}
            </div>

            {/* â”€â”€ Source filter tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
            {results && results.hits.length > 0 && (
              <div className="flex gap-1 mt-2">
                {(["all", "transcript", "visual"] as FilterMode[]).map((mode) => {
                  const count =
                    mode === "all"
                      ? results.hits.length
                      : results.hits.filter((h) => h.source === mode).length;
                  if (count === 0 && mode !== "all") return null;
                  return (
                    <button
                      key={mode}
                      onClick={() => setFilterMode(mode)}
                      className={`px-2 py-1 rounded text-[10px] font-medium transition-all
                        ${filterMode === mode
                          ? mode === "visual"
                            ? "bg-violet-600/30 text-violet-300 border border-violet-500/30"
                            : mode === "transcript"
                            ? "bg-sky-600/30 text-sky-300 border border-sky-500/30"
                            : "bg-white/10 text-white/80 border border-white/20"
                          : "bg-transparent text-white/40 border border-transparent hover:text-white/60"
                        }`}
                    >
                      {mode === "all" ? "All" : mode === "transcript" ? "ğŸ™ï¸ Transcript" : "ğŸ‘ï¸ Visual"}{" "}
                      ({count})
                    </button>
                  );
                })}
              </div>
            )}
          </div>

          <div className="flex-1 overflow-y-auto px-4 py-3 space-y-2">
            {/* Empty state */}
            {!results && !searching && (
              <div className="h-full flex items-center justify-center text-white/30 text-sm text-center px-4">
                <div>
                  Results will appear here
                  <br />
                  <span className="text-white/20 text-xs">
                    Transcript matches (ğŸ™ï¸) + CLIP visual matches (ğŸ‘ï¸)
                  </span>
                </div>
              </div>
            )}

            {/* Loading */}
            {searching && (
              <div className="h-full flex items-center justify-center">
                <div className="flex items-center gap-2 text-sm text-white/50">
                  <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
                  </svg>
                  Searching transcript + visual contentâ€¦
                </div>
              </div>
            )}

            {/* Best window summary */}
            {results?.best_window && (
              <div
                className="rounded-lg bg-indigo-600/10 border border-indigo-500/20 p-3 cursor-pointer
                           hover:bg-indigo-600/15 transition-colors"
                onClick={() => seekTo(-1, results.best_window!.start_seconds, results.best_window!.end_seconds)}
              >
                <div className="text-xs font-semibold text-indigo-300 mb-1">Best match window</div>
                <div className="text-xs text-white/70">
                  {fmtTime(results.best_window.start_seconds)} â€“ {fmtTime(results.best_window.end_seconds)}
                  <span className="ml-2 text-white/40">
                    ({results.best_window.hit_count} chunk{results.best_window.hit_count !== 1 ? "s" : ""})
                  </span>
                </div>
                {results.clip_url && (
                  <a
                    href={results.clip_url}
                    target="_blank"
                    rel="noreferrer"
                    className="mt-1.5 inline-block text-[10px] text-indigo-400 underline"
                    onClick={(e) => e.stopPropagation()}
                  >
                    â–¶ Download clip
                  </a>
                )}
              </div>
            )}

            {/* No results */}
            {results && filteredHits.length === 0 && (
              <div className="text-center text-white/40 text-sm py-8">
                {filterMode !== "all"
                  ? `No ${filterMode} matches found. Try "All" or a different query.`
                  : "No matching segments found. Try a different query."}
              </div>
            )}

            {/* Hit cards */}
            {filteredHits.map((hit, i) => (
              <div
                key={i}
                className={`rounded-lg border p-3 cursor-pointer transition-all text-xs
                  ${activeIdx === i
                    ? "border-indigo-500/50 bg-indigo-600/10"
                    : hit.source === "visual"
                    ? "border-violet-500/10 bg-violet-600/[0.03] hover:bg-violet-600/[0.06]"
                    : "border-white/5 bg-white/[0.02] hover:bg-white/[0.04]"}`}
                onClick={() => seekTo(i, hit.start_seconds, hit.end_seconds)}
              >
                <div className="flex items-center justify-between mb-1.5">
                  <div className="flex items-center gap-2">
                    <span className="font-mono text-indigo-300">
                      {fmtTime(hit.start_seconds)} â€“ {fmtTime(hit.end_seconds)}
                    </span>
                    {sourceBadge(hit.source)}
                  </div>
                  {distBadge(hit.distance)}
                </div>
                <p className={`leading-relaxed line-clamp-3 ${
                  hit.source === "visual" ? "text-violet-200/60 italic" : "text-white/60"
                }`}>
                  {hit.text}
                </p>
              </div>
            ))}
          </div>
        </section>
      </main>
    </div>
  );
}

